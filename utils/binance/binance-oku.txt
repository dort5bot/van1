








âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ âš ï¸ 

Bu yapÄ± orta/bÃ¼yÃ¼k Ã¶lÃ§ekli async Telegram bot iÃ§in uygun ve tÃ¼m Binance API endpoint'lerini desteklemektedir.

Binance API modÃ¼lÃ¼nÃ¼ inceleyip modÃ¼ler bir yapÄ±da

Mevcut Kod Analizi
âœ… GÃ¼Ã§lÃ¼ YÃ¶nler:
KapsamlÄ± API desteÄŸi (public/private endpoints)
Async/await pattern uygunluÄŸu
Circuit breaker ve retry mekanizmasÄ±
Rate limiting ve caching
WebSocket desteÄŸi
DetaylÄ± logging ve error handling
futures/spot tÃ¼m endpointâ€™leri async gather ile paralel Ã§alÄ±ÅŸtÄ±rma 
cache layerâ€™i Redis/ Memcached geÃ§irme



utils/
â”œâ”€â”€ binance/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ binance_a.py              # Ana aggregator
â”‚   â”œâ”€â”€ binance_request.py        # HTTP request mekanizmasÄ±
â”‚   â”œâ”€â”€ binance_public.py         # Public endpoints
â”‚   â”œâ”€â”€ binance_private.py        # Private endpoints (API key gerektiren)
â”‚   â”œâ”€â”€ binance_websocket.py      # WebSocket yÃ¶netimi
â”‚   â”œâ”€â”€ binance_circuit_breaker.py # Circuit breaker pattern
â”‚   â”œâ”€â”€ binance_utils.py          # YardÄ±mcÄ± fonksiyonlar
â”‚   â”œâ”€â”€ binance_constants.py      # Sabitler ve enum'lar
â”‚   â”œâ”€â”€ binance_metrics.py        # Metrik sÄ±nÄ±flarÄ±
â”‚   â””â”€â”€ binance_exceptions.py     # Ã–zel exception'lar
â”‚   â””â”€â”€ binance_types.py          # â­ YENÄ°: Type definitions
â””â”€â”€ config.py                     # Config yÃ¶netimi


analysis/, handler/ sadece binance_a.py Ã¼zerinden eriÅŸir

Ã–zet
âœ… YapÄ±lan Ä°yileÅŸtirmeler:

ModÃ¼ler YapÄ±: Tek dosya yerine mantÄ±ksal modÃ¼llere bÃ¶lÃ¼ndÃ¼
Type Hints: TÃ¼m fonksiyonlara tam type hint eklendi
Docstrings: TÃ¼m public metodlar iÃ§in detaylÄ± docstring
Error Handling: Merkezi hata yÃ¶netimi ve Ã¶zel exception'lar
Config YÃ¶netimi: Environment-based konfigÃ¼rasyon
Metrics: DetaylÄ± metrik takibi
Clean Code: PEP 8 uyumluluÄŸu ve okunabilirlik

ğŸ”§ Eklenen Ã–zellikler:
Context manager desteÄŸi
Connection pooling
Connection cleanup
DetaylÄ± logging
Metrics collection
Environment-based config



#===================================================

KullanÄ±m Ã–rneÄŸi
ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯--------------------------------
import asyncio
import logging
from utils.binance import BinanceClient, BinanceConfig

logging.basicConfig(level=logging.INFO)

async def main():
    config = BinanceConfig.from_env()
    
    async with BinanceClient(
        api_key="your_api_key",
        secret_key="your_secret_key",
        config=config
    ) as client:
        
        # Public API kullanÄ±mÄ±
        price = await client.get_symbol_price("BTCUSDT")
        print(f"BTC Price: {price['price']}")
        
        # WebSocket kullanÄ±mÄ±
        async def handle_ticker(data):
            print(f"Ticker update: {data}")
        
        await client.ws_ticker("btcusdt", handle_ticker)
        await asyncio.sleep(10)  # 10 saniye dinle

if __name__ == "__main__":
    asyncio.run(main())

ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯-------------------------------------

Bu Ã¶rnek, Binance API'ye baÄŸlanarak kripto para verilerini Ã§ekmek ve WebSocket Ã¼zerinden gerÃ§ek zamanlÄ± veri almakla ilgilidir. Ä°ÅŸte detaylÄ± aÃ§Ä±klama:

ğŸ“Œ NE YAPIYOR?
Binance API'ye BaÄŸlanÄ±yor:
Binance'in resmi API'sine baÄŸlanÄ±yor
REST API Ã¼zerinden anlÄ±k fiyat verisi Ã§ekiyor
WebSocket Ã¼zerinden gerÃ§ek zamanlÄ± veri akÄ±ÅŸÄ± baÅŸlatÄ±yor
Hangi Verileri AlÄ±yor:
BTCUSDT sembolÃ¼nÃ¼n anlÄ±k fiyatÄ±
AynÄ± sembolÃ¼n gerÃ§ek zamanlÄ± ticker verileri (fiyat deÄŸiÅŸimleri, hacim, vs.)

ğŸ¯ KULLANIM ALANLARI
ğŸ¯ğŸ¯-1. Kripto Para BotlarÄ± ğŸ¤–
python
# Trading bot Ã¶rneÄŸi
async def trading_strategy(client):
    price = await client.get_symbol_price("BTCUSDT")
    if float(price['price']) < 50000:
        # AlÄ±m emri ver
        order = await client.place_order(
            symbol="BTCUSDT", 
            side="BUY", 
            type_="MARKET", 
            quantity=0.001
        )



ğŸ¯ğŸ¯-2. Fiyat Ä°zleme & Alarm Sistemleri â°

# Price alert Ã¶rneÄŸi
async def price_alert(client, symbol, threshold):
    async def check_price(data):
        if float(data['c']) > threshold:
            print(f"ALARM! {symbol} {threshold} Ã¼zerinde: {data['c']}")
    
    await client.ws_ticker(symbol.lower(), check_price)



ğŸ¯ğŸ¯-3. Veri Analizi & Grafikleme ğŸ“Š

# Teknik analiz Ã¶rneÄŸi
async def technical_analysis(client):
    # 1 saatlik kline verilerini al
    klines = await client.get_klines_dataframe(
        "BTCUSDT", 
        interval="1h", 
        limit=100
    )
    
    # Moving average hesapla
    klines['MA20'] = klines['close'].rolling(window=20).mean()
    print(klines.tail())



ğŸ¯ğŸ¯-4. PortfÃ¶y Takibi ğŸ’¼

# Portfolio monitoring
async def portfolio_tracker(client):
    balances = await client.get_account_balance()
    for balance in balances['balances']:
        if float(balance['free']) > 0:
            print(f"{balance['asset']}: {balance['free']}")



ğŸ¯ğŸ¯-ğŸ”§ TEKNÄ°K DETAYLAR
Environment Variables (.env)
env
BINANCE_API_KEY=your_api_key_here
BINANCE_API_SECRET=your_secret_key_here
BINANCE_BASE_URL=https://api.binance.com
BINANCE_REQUEST_TIMEOUT=30
WebSocket Events ğŸ“¡
Ã–rnekteki handle_ticker fonksiyonu ÅŸu verileri alÄ±r:

json
{
  "e": "24hrTicker",  // Event type
  "s": "BTCUSDT",     // Symbol
  "c": "50123.45",    // Current price
  "h": "50200.00",    // High price
  "l": "49900.00",    // Low price
  "v": "1234.56",     // Volume
  "q": "62500000"     // Quote volume
}
ğŸš€ GERÃ‡EK DÃœNYA KULLANIM SENARYOLARI
Senaryo 1: Arbitraj Botu
python
async def arbitrage_bot(client):
    # Binance ve diÄŸer borsalardaki fiyat farkÄ±nÄ± bul
    binance_price = await client.get_symbol_price("BTCUSDT")
    # DiÄŸer borsa API'sinden fiyat al
    # Fiyat farkÄ±ndan kar etmeye Ã§alÄ±ÅŸ
Senaryo 2: Social Trading
python
async def copy_trading(client):
    # BaÅŸarÄ±lÄ± trader'larÄ±n iÅŸlemlerini takip et
    # WebSocket ile gerÃ§ek zamanlÄ± pozisyonlarÄ± izle
    # Otomatik olarak aynÄ± iÅŸlemleri yap
Senaryo 3: Market Maker
python
async def market_making(client):
    # Order book'taki spread'i sÃ¼rekli izle
    # Her iki tarafta da (alÄ±ÅŸ-satÄ±ÅŸ) limit emirleri ver
    # Spread'ten kÃ¼Ã§Ã¼k kazanÃ§lar elde et
âš ï¸ Ã–NEMLÄ° NOTLAR
API Limitleri: Binance'in rate limit'lerine dikkat edin
WebSocket BaÄŸlantÄ±larÄ±: Ã‡ok fazla WebSocket baÄŸlantÄ±sÄ± aÃ§mayÄ±n
Hata YÃ¶netimi: TÃ¼m API Ã§aÄŸrÄ±larÄ±nÄ± try-except ile sarmalayÄ±n
GÃ¼venlik: API key'lerinizi gÃ¼vende tutun

ğŸ“ˆ Ã‡IKTILAR
Terminal Ã‡Ä±ktÄ±sÄ± Ã–rneÄŸi:

text
BTC Price: 50123.45
Ticker update: {'e': '24hrTicker', 's': 'BTCUSDT', 'c': '50125.00', ...}
Ticker update: {'e': '24hrTicker', 's': 'BTCUSDT', 'c': '50130.00', ...}
Bu Ã¶rnek, kripto para trading botlarÄ±, fiyat izleme sistemleri, ve finansal analiz araÃ§larÄ± geliÅŸtirmek isteyenler iÃ§in temel bir baÅŸlangÄ±Ã§ noktasÄ±dÄ±r. ğŸš€





âš ï¸âš ï¸âš ï¸ Ã–NEMLÄ° NOTLAR âš ï¸âš ï¸âš ï¸
API Limitleri: Binance'in rate limit'lerine dikkat edin
WebSocket BaÄŸlantÄ±larÄ±: Ã‡ok fazla WebSocket baÄŸlantÄ±sÄ± aÃ§mayÄ±n
Hata YÃ¶netimi: TÃ¼m API Ã§aÄŸrÄ±larÄ±nÄ± try-except ile sarmalayÄ±n
GÃ¼venlik: API key'lerinizi gÃ¼vende tutun
 
BUNLARA HANGÄ° AÅAMADA DÄ°KKAT ETMEK GEREKÄ°YOR
Ã–zet:
Bu ayarlarÄ± projenin baÅŸlangÄ±cÄ±nda config dosyalarÄ±nda yapmalÄ± ve sÃ¼rekli monitor etmelisiniz!
 
 
 
ğŸ¯API Limitleri - TÃœM AÅAMALARDA!
# âœ… DOÄRU KULLANIM - TÃ¼m aÅŸamalarda dikkat edilmeli

async def safe_api_call(client):
    try:
        # 1. GELÄ°ÅTÄ°RME aÅŸamasÄ±nda: Test ederken dikkat
        price = await client.get_symbol_price("BTCUSDT")
        
        # 2. TEST aÅŸamasÄ±nda: Rate limit simÃ¼lasyonu yap
        await asyncio.sleep(0.1)  # Artificial delay
        
        # 3. PRODUCTION aÅŸamasÄ±nda: Monitoring ekle
        metrics = client.get_metrics()
        if metrics['http']['total_requests'] > 1000:
            print("Rate limit yaklaÅŸÄ±yor!")
            
    except BinanceRateLimitError as e:
        # 4. HATA YÃ–NETÄ°MÄ° aÅŸamasÄ±nda: Retry mekanizmasÄ±
        print(f"Rate limit aÅŸÄ±ldÄ±: {e}")
        await asyncio.sleep(60)  # 1 dakika bekle
		
		
ğŸ¯ğŸ¯WebSocket BaÄŸlantÄ±larÄ± - BAÅLANGIÃ‡TA!

# âœ… WebSocket sÄ±nÄ±rlamasÄ± - Proje baÅŸlangÄ±cÄ±nda ayarla
class SafeWebSocketManager:
    def __init__(self, max_connections=5):  # âš ï¸ SINIR BURADA!
        self.max_connections = max_connections
        self.active_connections = 0
        
    async def subscribe(self, stream_name, callback):
        if self.active_connections >= self.max_connections:
            raise Exception("Maksimum WebSocket baÄŸlantÄ± sayÄ±sÄ± aÅŸÄ±ldÄ±")
        
        self.active_connections += 1
        # BaÄŸlantÄ±yÄ± aÃ§...



ğŸ¯ğŸ¯Hata YÃ¶netimi - KODLAMA SIRASINDA!

# âœ… Her API Ã§aÄŸrÄ±sÄ±nÄ± try-except ile sarmala
async def get_price_safely(client, symbol):
    try:
        return await client.get_symbol_price(symbol)
    except BinanceAPIError as e:
        logging.error(f"API hatasÄ±: {e}")
        return None
    except Exception as e:
        logging.critical(f"Beklenmeyen hata: {e}")
        return None



ğŸ¯ğŸ¯GÃ¼venlik - PROJE KURULUMUNDA!

# âœ… .env dosyasÄ± - Ä°lk kurulumda ayarla
# .env file (GÄ°T'TE PAYLAÅMA!)
BINANCE_API_KEY=your_actual_key_here
BINANCE_API_SECRET=your_actual_secret_here

# âœ… Config dosyasÄ± - Environment variables kullan
config = BinanceConfig(
    api_key=os.getenv("BINANCE_API_KEY"),  # âš ï¸ GÃ¼venli!
    secret_key=os.getenv("BINANCE_API_SECRET")
)


ğŸ¯ğŸ¯
ğŸ¯ğŸ¯
2. SINIRLAR ve AYARLAR

ğŸ¯ğŸ¯API Rate Limitleri ğŸ“‰
Limit TÃ¼rÃ¼			Standart Limit		VIP Limit				Ayar Yeri
REST Requests		1,200/dakika		6,000/dakika			config.py
Order Requests		10/saniye			100/saniye				BinanceConfig (config.py iÃ§erisinde)
Weighted Requests	1,200 weight/dakika	12,000 weight/dakika	Request baÅŸÄ±na


# ğŸ“ config.py - Rate Limit AyarlarÄ±
class BinanceConfig:
    # âš ï¸ BURAYI AYARLA!
    MAX_REQUESTS_PER_SECOND = 5  # Saniyede maksimum istek
    LIMITER_RATE = 10            # 10 istekte bir
    LIMITER_PERIOD = 1           # 1 saniyede
    
    # Weight-based limiting
    REQUEST_WEIGHTS = {
        '/api/v3/ticker/price': 1,
        '/api/v3/order': 10,     # Order daha yÃ¼ksek weight
        '/api/v3/account': 10
    }

Rate Limit Koruma â°

# ğŸ“ binance_request.py - Otomatik rate limiting
async def _request(self, method, path, params=None):
    # Weight kontrolÃ¼
    weight = self.config.REQUEST_WEIGHTS.get(path, 1)
    if self.current_weight + weight > 1200:  # DakikalÄ±k limit
        await asyncio.sleep(60)  # 1 dakika bekle
        
    # Ä°stek aralÄ±ÄŸÄ± kontrolÃ¼
    elapsed = time.time() - self.last_request_time
    if elapsed < self.config.MIN_REQUEST_INTERVAL:
        await asyncio.sleep(self.config.MIN_REQUEST_INTERVAL - elapsed)



ğŸ¯ğŸ¯WebSocket SÄ±nÄ±rlarÄ± ğŸ”Œ
BaÄŸlantÄ± TÃ¼rÃ¼		Maksimum Limit	Ã–nerilen	Ayar Yeri
Toplam Connection	300 IP baÅŸÄ±na	5-10		WebSocketManager
Stream SayÄ±sÄ±		SÄ±nÄ±rsÄ±z*		10-20		BinanceClient
Ping AralÄ±ÄŸÄ±		-				30sn		WebSocketManager

# ğŸ“ WebSocketManager - BaÄŸlantÄ± SÄ±nÄ±rÄ±
class BinanceWebSocketManager:
    def __init__(self, max_connections=10):  # âš ï¸ BURAYI AYARLA!
        self.max_connections = max_connections
        self.current_connections = 0
        
    async def subscribe(self, stream_name, callback):
        if self.current_connections >= self.max_connections:
            raise BinanceWebSocketError(
                f"Maksimum {self.max_connections} WebSocket baÄŸlantÄ±sÄ±na ulaÅŸÄ±ldÄ±"
            )
        
        self.current_connections += 1
        # BaÄŸlantÄ±yÄ± aÃ§...


WebSocket Connection Pool ğŸŠ
# ğŸ“ WebSocket connection pool implementasyonu
class WebSocketPool:
    def __init__(self, max_pool_size=5):
        self.pool = []
        self.max_pool_size = max_pool_size
        
    async def get_connection(self):
        if len(self.pool) < self.max_pool_size:
            # Yeni baÄŸlantÄ± oluÅŸtur
            ws = await self._create_connection()
            self.pool.append(ws)
            return ws
        else:
            # Pool'dan mevcut baÄŸlantÄ±yÄ± ver
            return random.choice(self.pool)



Otomatik Retry MekanizmasÄ± ğŸ”„
# ğŸ“ Circuit breaker ile otomatik retry
class SmartRetry:
    def __init__(self, max_retries=3, backoff_factor=2):
        self.max_retries = max_retries
        self.backoff_factor = backoff_factor
        
    async def execute(self, func, *args):
        for attempt in range(self.max_retries):
            try:
                return await func(*args)
            except BinanceRateLimitError:
                wait_time = self.backoff_factor ** attempt
                print(f"Rate limit! {wait_time}s bekleniyor...")
                await asyncio.sleep(wait_time)



MONITORING ve ALERT SÄ°STEMÄ°
# ğŸ“ Monitoring sÄ±nÄ±fÄ±
class APIMonitor:
    def __init__(self):
        self.request_count = 0
        self.last_reset = time.time()
        
    def check_limits(self):
        current_time = time.time()
        if current_time - self.last_reset > 60:  # Her dakika reset
            self.request_count = 0
            self.last_reset = current_time
            
        if self.request_count > 1000:  # âš ï¸ Limit yaklaÅŸÄ±yor!
            self.send_alert("Rate limit yaklaÅŸÄ±yor!")
            
    def send_alert(self, message):
        # Telegram, Email, Discord vs. bildirim gÃ¶nder
        print(f"ğŸš¨ ALERT: {message}")



ğŸ¯ KRÄ°TÄ°K NOKTALAR:
Development Phase: Testlerde dÃ¼ÅŸÃ¼k limitlerle baÅŸla
Testing Phase: Rate limit senaryolarÄ±nÄ± test et
Production Phase: Monitoring ve alert sistemleri kur
Emergency Plan: Rate limit aÅŸÄ±lÄ±rsa ne yapÄ±lacaÄŸÄ±nÄ± planla

# âœ… SON AYARLAR - config.py'de yapÄ±lmalÄ±
BinanceConfig(
    MAX_REQUESTS_PER_SECOND=3,    # Conservative baÅŸla
    MAX_WEBSOCKET_CONNECTIONS=5,  # GÃ¼venli limit
    ENABLE_RATE_LIMIT_CHECKS=True # Monitoring aÃ§Ä±k
)

				



ğŸ¯ğŸ¯ğŸ¯

